var NgxImageZoomComponent_1;
import { __decorate } from "tslib";
import { Component, ElementRef, EventEmitter, Input, OnChanges, OnDestroy, OnInit, Output, Renderer2, ViewChild } from '@angular/core';
let NgxImageZoomComponent = NgxImageZoomComponent_1 = class NgxImageZoomComponent {
    constructor(renderer) {
        this.renderer = renderer;
        this.zoomScroll = new EventEmitter();
        this.zoomPosition = new EventEmitter();
        this.enableLens = false;
        this.lensBorderRadius = 0;
        this.lensWidth = 100;
        this.lensHeight = 100;
        this.zoomMode = 'hover';
        this.magnification = 1;
        this.enableScrollZoom = false;
        this.scrollStepSize = 0.1;
        this.circularLens = false;
        this.maxZoomRatio = 2;
        this.zoomingEnabled = false;
        this.zoomFrozen = false;
        this.isReady = false;
        this.thumbImageLoaded = false;
        this.fullImageLoaded = false;
        this.eventListeners = [];
    }
    set setThumbImage(thumbImage) {
        this.thumbImageLoaded = false;
        this.isReady = false;
        this.thumbImage = thumbImage;
    }
    set setFullImage(fullImage) {
        this.fullImageLoaded = false;
        this.isReady = false;
        this.fullImage = fullImage;
    }
    set setZoomMode(zoomMode) {
        if (NgxImageZoomComponent_1.validZoomModes.some(m => m === zoomMode)) {
            this.zoomMode = zoomMode;
        }
    }
    set setMagnification(magnification) {
        this.magnification = Number(magnification) || this.magnification;
        this.zoomScroll.emit(this.magnification);
    }
    set setMinZoomRatio(minZoomRatio) {
        const ratio = Number(minZoomRatio) || this.minZoomRatio || this.baseRatio || 0;
        this.minZoomRatio = Math.max(ratio, this.baseRatio || 0);
    }
    set setMaxZoomRatio(maxZoomRatio) {
        this.maxZoomRatio = Number(maxZoomRatio) || this.maxZoomRatio;
    }
    set setScrollStepSize(stepSize) {
        this.scrollStepSize = Number(stepSize) || this.scrollStepSize;
    }
    set setEnableLens(enable) {
        this.enableLens = Boolean(enable);
    }
    set setLensWidth(width) {
        this.lensWidth = Number(width) || this.lensWidth;
    }
    set setLensHeight(height) {
        this.lensHeight = Number(height) || this.lensHeight;
    }
    set setCircularLens(enable) {
        this.circularLens = Boolean(enable);
    }
    set setEnableScrollZoom(enable) {
        this.enableScrollZoom = Boolean(enable);
    }
    ngOnInit() {
        this.setUpEventListeners();
    }
    ngOnChanges() {
        if (this.enableLens) {
            if (this.circularLens) {
                this.lensBorderRadius = this.lensWidth / 2;
            }
            else {
                this.lensBorderRadius = 0;
            }
        }
        this.calculateRatioAndOffset();
        this.calculateImageAndLensPosition();
    }
    ngOnDestroy() {
        this.eventListeners.forEach((destroyFn) => destroyFn());
    }
    /**
     * Template helper methods
     */
    onThumbImageLoaded() {
        this.thumbImageLoaded = true;
        this.checkImagesLoaded();
    }
    onFullImageLoaded() {
        this.fullImageLoaded = true;
        this.checkImagesLoaded();
    }
    setUpEventListeners() {
        if (this.zoomMode === 'hover') {
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mouseenter', (event) => this.hoverMouseEnter(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mouseleave', () => this.hoverMouseLeave()));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mousemove', (event) => this.hoverMouseMove(event)));
        }
        else if (this.zoomMode === 'toggle') {
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'click', (event) => this.toggleClick(event)));
        }
        else if (this.zoomMode === 'click') {
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'click', (event) => this.clickStarter(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mouseleave', () => this.clickMouseLeave()));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mousemove', (event) => this.clickMouseMove(event)));
        }
        else if (this.zoomMode === 'hover-freeze') {
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mouseenter', (event) => this.hoverFreezeMouseEnter(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mouseleave', () => this.hoverFreezeMouseLeave()));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mousemove', (event) => this.hoverFreezeMouseMove(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'click', (event) => this.hoverFreezeClick(event)));
        }
        if (this.enableScrollZoom) {
            // Chrome: 'mousewheel', Firefox: 'DOMMouseScroll', IE: 'onmousewheel'
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'mousewheel', (event) => this.onMouseWheel(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'DOMMouseScroll', (event) => this.onMouseWheel(event)));
            this.eventListeners.push(this.renderer.listen(this.zoomContainer.nativeElement, 'onmousewheel', (event) => this.onMouseWheel(event)));
        }
        if (this.enableLens && this.circularLens) {
            this.lensBorderRadius = this.lensWidth / 2;
        }
    }
    checkImagesLoaded() {
        this.calculateRatioAndOffset();
        if (this.thumbImageLoaded && this.fullImageLoaded) {
            this.calculateImageAndLensPosition();
            this.isReady = true;
        }
    }
    /**
     * Zoom position setters
     */
    setZoomPosition(left, top) {
        this.latestMouseLeft = Number(left) || this.latestMouseLeft;
        this.latestMouseTop = Number(top) || this.latestMouseTop;
        const c = {
            x: this.latestMouseLeft,
            y: this.latestMouseTop
        };
        this.zoomPosition.emit(c);
    }
    /**
     * Mouse wheel event
     */
    onMouseWheel(event) {
        // Don't eat events if zooming isn't active
        if (!this.zoomingEnabled || this.zoomFrozen) {
            return;
        }
        event = window.event || event; // old IE
        const direction = Math.max(Math.min((event.wheelDelta || -event.detail), 1), -1);
        if (direction > 0) {
            // up
            this.setMagnification = Math.min(this.magnification + this.scrollStepSize, this.maxZoomRatio);
        }
        else {
            // down
            this.setMagnification = Math.max(this.magnification - this.scrollStepSize, this.minZoomRatio);
        }
        this.calculateRatio();
        this.calculateZoomPosition(event);
        // Prevent scrolling on page.
        event.returnValue = false; // IE
        if (event.preventDefault) {
            event.preventDefault(); // Chrome & FF
        }
    }
    /**
     * Hover mode
     */
    hoverMouseEnter(event) {
        this.zoomOn(event);
    }
    hoverMouseLeave() {
        this.zoomOff();
    }
    hoverMouseMove(event) {
        this.calculateZoomPosition(event);
    }
    /**
     * Toggle mode
     */
    toggleClick(event) {
        if (this.zoomingEnabled) {
            this.zoomOff();
        }
        else {
            this.zoomOn(event);
        }
    }
    /**
     * Click mode
     */
    clickStarter(event) {
        if (this.zoomingEnabled === false) {
            this.zoomOn(event);
        }
    }
    clickMouseLeave() {
        this.zoomOff();
    }
    clickMouseMove(event) {
        if (this.zoomingEnabled) {
            this.calculateZoomPosition(event);
        }
    }
    /**
     * Hover freeze mode
     */
    hoverFreezeMouseEnter(event) {
        if (this.zoomingEnabled && !this.zoomFrozen) {
            this.zoomOn(event);
        }
    }
    hoverFreezeMouseLeave() {
        if (this.zoomingEnabled && !this.zoomFrozen) {
            this.zoomOff();
        }
    }
    hoverFreezeMouseMove(event) {
        if (this.zoomingEnabled && !this.zoomFrozen) {
            this.calculateZoomPosition(event);
        }
    }
    hoverFreezeClick(event) {
        if (this.zoomingEnabled && this.zoomFrozen) {
            this.zoomFrozen = false;
            this.zoomOff();
        }
        else if (this.zoomingEnabled) {
            this.zoomFrozen = true;
        }
        else {
            this.zoomOn(event);
        }
    }
    /**
     * Private helper methods
     */
    zoomOn(event) {
        if (this.isReady) {
            this.zoomingEnabled = true;
            this.calculateRatioAndOffset();
            this.display = 'block';
            this.calculateZoomPosition(event);
        }
    }
    zoomOff() {
        this.zoomingEnabled = false;
        this.display = 'none';
    }
    calculateZoomPosition(event) {
        const newLeft = Math.max(Math.min(event.offsetX, this.thumbWidth), 0);
        const newTop = Math.max(Math.min(event.offsetY, this.thumbHeight), 0);
        this.setZoomPosition(newLeft, newTop);
        this.calculateImageAndLensPosition();
    }
    calculateImageAndLensPosition() {
        let lensLeftMod = 0;
        let lensTopMod = 0;
        if (this.enableLens) {
            lensLeftMod = this.lensLeft = this.latestMouseLeft - this.lensWidth / 2;
            lensTopMod = this.lensTop = this.latestMouseTop - this.lensHeight / 2;
        }
        this.fullImageLeft = (this.latestMouseLeft * -this.xRatio) - lensLeftMod;
        this.fullImageTop = (this.latestMouseTop * -this.yRatio) - lensTopMod;
    }
    calculateRatioAndOffset() {
        this.thumbWidth = this.imageThumbnail.nativeElement.width;
        this.thumbHeight = this.imageThumbnail.nativeElement.height;
        // If lens is disabled, set lens size to equal thumb size and position it on top of the thumb
        if (!this.enableLens) {
            this.lensWidth = this.thumbWidth;
            this.lensHeight = this.thumbHeight;
            this.lensLeft = 0;
            this.lensTop = 0;
        }
        // getBoundingClientRect() ? https://stackoverflow.com/a/44008873
        this.offsetTop = this.imageThumbnail.nativeElement.getBoundingClientRect().top;
        this.offsetLeft = this.imageThumbnail.nativeElement.getBoundingClientRect().left;
        if (this.fullImage === undefined) {
            this.fullImage = this.thumbImage;
        }
        if (this.fullImageLoaded) {
            this.fullWidth = this.fullSizeImage.nativeElement.naturalWidth;
            this.fullHeight = this.fullSizeImage.nativeElement.naturalHeight;
            this.baseRatio = Math.max((this.thumbWidth / this.fullWidth), (this.thumbHeight / this.fullHeight));
            // Don't allow zooming to smaller than thumbnail size
            this.minZoomRatio = Math.max(this.minZoomRatio || 0, this.baseRatio || 0);
            this.calculateRatio();
        }
    }
    calculateRatio() {
        this.magnifiedWidth = (this.fullWidth * this.magnification);
        this.magnifiedHeight = (this.fullHeight * this.magnification);
        this.xRatio = (this.magnifiedWidth - this.thumbWidth) / this.thumbWidth;
        this.yRatio = (this.magnifiedHeight - this.thumbHeight) / this.thumbHeight;
    }
};
NgxImageZoomComponent.validZoomModes = ['hover', 'toggle', 'click', 'hover-freeze'];
NgxImageZoomComponent.ctorParameters = () => [
    { type: Renderer2 }
];
__decorate([
    ViewChild('zoomContainer', { static: true })
], NgxImageZoomComponent.prototype, "zoomContainer", void 0);
__decorate([
    ViewChild('imageThumbnail', { static: true })
], NgxImageZoomComponent.prototype, "imageThumbnail", void 0);
__decorate([
    ViewChild('fullSizeImage', { static: true })
], NgxImageZoomComponent.prototype, "fullSizeImage", void 0);
__decorate([
    Output()
], NgxImageZoomComponent.prototype, "zoomScroll", void 0);
__decorate([
    Output()
], NgxImageZoomComponent.prototype, "zoomPosition", void 0);
__decorate([
    Input('thumbImage')
], NgxImageZoomComponent.prototype, "setThumbImage", null);
__decorate([
    Input('fullImage')
], NgxImageZoomComponent.prototype, "setFullImage", null);
__decorate([
    Input('zoomMode')
], NgxImageZoomComponent.prototype, "setZoomMode", null);
__decorate([
    Input('magnification')
], NgxImageZoomComponent.prototype, "setMagnification", null);
__decorate([
    Input('minZoomRatio')
], NgxImageZoomComponent.prototype, "setMinZoomRatio", null);
__decorate([
    Input('maxZoomRatio')
], NgxImageZoomComponent.prototype, "setMaxZoomRatio", null);
__decorate([
    Input('scrollStepSize')
], NgxImageZoomComponent.prototype, "setScrollStepSize", null);
__decorate([
    Input('enableLens')
], NgxImageZoomComponent.prototype, "setEnableLens", null);
__decorate([
    Input('lensWidth')
], NgxImageZoomComponent.prototype, "setLensWidth", null);
__decorate([
    Input('lensHeight')
], NgxImageZoomComponent.prototype, "setLensHeight", null);
__decorate([
    Input('circularLens')
], NgxImageZoomComponent.prototype, "setCircularLens", null);
__decorate([
    Input('enableScrollZoom')
], NgxImageZoomComponent.prototype, "setEnableScrollZoom", null);
NgxImageZoomComponent = NgxImageZoomComponent_1 = __decorate([
    Component({
        selector: 'lib-ngx-image-zoom',
        template: "<div #zoomContainer class=\"ngxImageZoomContainer\"\n     [style.width.px]=\"this.thumbWidth\" [style.height.px]=\"this.thumbHeight\">\n\n  <img #imageThumbnail class=\"ngxImageZoomThumbnail\" [src]=\"thumbImage\" (load)=\"onThumbImageLoaded()\"/>\n\n  <div [ngClass]=\"{'ngxImageZoomFullContainer': true, 'ngxImageZoomLensEnabled': this.enableLens}\"\n       [style.display]=\"this.display\"\n       [style.top.px]=\"this.lensTop\"\n       [style.left.px]=\"this.lensLeft\"\n       [style.width.px]=\"this.lensWidth\"\n       [style.height.px]=\"this.lensHeight\"\n       [style.border-radius.px]=\"this.lensBorderRadius\"\n  >\n    <img #fullSizeImage class=\"ngxImageZoomFull\" [src]=\"fullImage\"\n         (load)=\"onFullImageLoaded()\"\n         [style.display]=\"this.display\"\n         [style.top.px]=\"this.fullImageTop\"\n         [style.left.px]=\"this.fullImageLeft\"\n         [style.width.px]=\"this.magnifiedWidth\"\n         [style.height.px]=\"this.magnifiedHeight\"\n    />\n  </div>\n</div>\n",
        styles: [".ngxImageZoomContainer{position:relative;margin:auto;overflow:hidden;pointer-events:none}.ngxImageZoomThumbnail{pointer-events:all}.ngxImageZoomFull{position:absolute;max-width:none;max-height:none;display:none;pointer-events:none}.ngxImageZoomFullContainer{position:absolute;overflow:hidden;pointer-events:none}.ngxImageZoomFullContainer.ngxImageZoomLensEnabled{border:2px solid red;cursor:crosshair;pointer-events:none}"]
    })
], NgxImageZoomComponent);
export { NgxImageZoomComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWltYWdlLXpvb20uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWltYWdlLXpvb20vIiwic291cmNlcyI6WyJsaWIvbmd4LWltYWdlLXpvb20uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQVl2SSxJQUFhLHFCQUFxQiw2QkFBbEMsTUFBYSxxQkFBcUI7SUFzRDlCLFlBQW9CLFFBQW1CO1FBQW5CLGFBQVEsR0FBUixRQUFRLENBQVc7UUE5QzdCLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQ3hDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztRQVM1QyxlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLHFCQUFnQixHQUFHLENBQUMsQ0FBQztRQVFyQixjQUFTLEdBQUcsR0FBRyxDQUFDO1FBQ2hCLGVBQVUsR0FBRyxHQUFHLENBQUM7UUFFaEIsYUFBUSxHQUFHLE9BQU8sQ0FBQztRQUNuQixrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUNsQixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsbUJBQWMsR0FBRyxHQUFHLENBQUM7UUFDckIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFJckIsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFLakIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixvQkFBZSxHQUFHLEtBQUssQ0FBQztRQUt4QixtQkFBYyxHQUFtQixFQUFFLENBQUM7SUFHNUMsQ0FBQztJQUdELElBQVcsYUFBYSxD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QURDLEtBQUssQ0FBQyxjQUFjLENBQUM7NERBSXJCO0FBR0Q7SUFEQyxLQUFLLENBQUMsY0FBYyxDQUFDOzREQUdyQjtBQUdEO0lBREMsS0FBSyxDQUFDLGdCQUFnQixDQUFDOzhEQUd2QjtBQUdEO0lBREMsS0FBSyxDQUFDLFlBQVksQ0FBQzswREFHbkI7QUFHRDtJQURDLEtBQUssQ0FBQyxXQUFXLENBQUM7eURBR2xCO0FBR0Q7SUFEQyxLQUFLLENBQUMsWUFBWSxDQUFDOzBEQUduQjtBQUdEO0lBREMsS0FBSyxDQUFDLGNBQWMsQ0FBQzs0REFHckI7QUFHRDtJQURDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztnRUFHekI7QUEzSFEscUJBQXFCO0lBTGpDLFNBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxvQkFBb0I7UUFDOUIsZ2dDQUE4Qzs7S0FFakQsQ0FBQztHQUNXLHFCQUFxQixDQXVhakM7U0F2YVkscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29vcmQge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG59XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbGliLW5neC1pbWFnZS16b29tJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbmd4LWltYWdlLXpvb20uY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL25neC1pbWFnZS16b29tLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hJbWFnZVpvb21Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcblxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHZhbGlkWm9vbU1vZGVzOiBzdHJpbmdbXSA9IFsnaG92ZXInLCAndG9nZ2xlJywgJ2NsaWNrJywgJ2hvdmVyLWZyZWV6ZSddO1xuXG4gICAgQFZpZXdDaGlsZCgnem9vbUNvbnRhaW5lcicsIHtzdGF0aWM6IHRydWV9KSB6b29tQ29udGFpbmVyICE6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnaW1hZ2VUaHVtYm5haWwnLCB7c3RhdGljOiB0cnVlfSkgaW1hZ2VUaHVtYm5haWwgITogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdmdWxsU2l6ZUltYWdlJywge3N0YXRpYzogdHJ1ZX0pIGZ1bGxTaXplSW1hZ2UgITogRWxlbWVudFJlZjtcblxuICAgIEBPdXRwdXQoKSB6b29tU2Nyb2xsID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG4gICAgQE91dHB1dCgpIHpvb21Qb3NpdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXI8Q29vcmQ+KCk7XG5cbiAgICBwdWJsaWMgZGlzcGxheTogc3RyaW5nO1xuICAgIHB1YmxpYyBmdWxsSW1hZ2VUb3A6IG51bWJlcjtcbiAgICBwdWJsaWMgZnVsbEltYWdlTGVmdDogbnVtYmVyO1xuICAgIHB1YmxpYyBtYWduaWZpZWRXaWR0aDogbnVtYmVyO1xuICAgIHB1YmxpYyBtYWduaWZpZWRIZWlnaHQ6IG51bWJlcjtcbiAgICBwdWJsaWMgbGVuc1RvcDogbnVtYmVyO1xuICAgIHB1YmxpYyBsZW5zTGVmdDogbnVtYmVyO1xuICAgIHB1YmxpYyBlbmFibGVMZW5zID0gZmFsc2U7XG4gICAgcHVibGljIGxlbnNCb3JkZXJSYWRpdXMgPSAwO1xuXG4gICAgcHVibGljIHRodW1iSW1hZ2U6IHN0cmluZztcbiAgICBwdWJsaWMgZnVsbEltYWdlOiBzdHJpbmc7XG4gICAgcHVibGljIHRodW1iV2lkdGg6IG51bWJlcjtcbiAgICBwdWJsaWMgdGh1bWJIZWlnaHQ6IG51bWJlcjtcbiAgICBwdWJsaWMgZnVsbFdpZHRoOiBudW1iZXI7XG4gICAgcHVibGljIGZ1bGxIZWlnaHQ6IG51bWJlcjtcbiAgICBwdWJsaWMgbGVuc1dpZHRoID0gMTAwO1xuICAgIHB1YmxpYyBsZW5zSGVpZ2h0ID0gMTAwO1xuXG4gICAgcHJpdmF0ZSB6b29tTW9kZSA9ICdob3Zlcic7XG4gICAgcHJpdmF0ZSBtYWduaWZpY2F0aW9uID0gMTtcbiAgICBwcml2YXRlIGVuYWJsZVNjcm9sbFpvb20gPSBmYWxzZTtcbiAgICBwcml2YXRlIHNjcm9sbFN0ZXBTaXplID0gMC4xO1xuICAgIHByaXZhdGUgY2lyY3VsYXJMZW5zID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIGJhc2VSYXRpbzogbnVtYmVyO1xuICAgIHByaXZhdGUgbWluWm9vbVJhdGlvO1xuICAgIHByaXZhdGUgbWF4Wm9vbVJhdGlvID0gMjtcbiAgICBwcml2YXRlIHhSYXRpbzogbnVtYmVyO1xuICAgIHByaXZhdGUgeVJhdGlvOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBvZmZzZXRMZWZ0OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBvZmZzZXRUb3A6IG51bWJlcjtcbiAgICBwcml2YXRlIHpvb21pbmdFbmFibGVkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB6b29tRnJvemVuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBpc1JlYWR5ID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB0aHVtYkltYWdlTG9hZGVkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBmdWxsSW1hZ2VMb2FkZWQgPSBmYWxzZTtcblxuICAgIHByaXZhdGUgbGF0ZXN0TW91c2VMZWZ0OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBsYXRlc3RNb3VzZVRvcDogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBldmVudExpc3RlbmVyczogKCgpID0+IHZvaWQpW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIH1cblxuICAgIEBJbnB1dCgndGh1bWJJbWFnZScpXG4gICAgcHVibGljIHNldCBzZXRUaHVtYkltYWdlKHRodW1iSW1hZ2U6IHN0cmluZykge1xuICAgICAgICB0aGlzLnRodW1iSW1hZ2VMb2FkZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1JlYWR5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMudGh1bWJJbWFnZSA9IHRodW1iSW1hZ2U7XG4gICAgfVxuXG4gICAgQElucHV0KCdmdWxsSW1hZ2UnKVxuICAgIHB1YmxpYyBzZXQgc2V0RnVsbEltYWdlKGZ1bGxJbWFnZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZnVsbEltYWdlTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNSZWFkeSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZ1bGxJbWFnZSA9IGZ1bGxJbWFnZTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ3pvb21Nb2RlJylcbiAgICBwdWJsaWMgc2V0IHNldFpvb21Nb2RlKHpvb21Nb2RlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKE5neEltYWdlWm9vbUNvbXBvbmVudC52YWxpZFpvb21Nb2Rlcy5zb21lKG0gPT4gbSA9PT0gem9vbU1vZGUpKSB7XG4gICAgICAgICAgICB0aGlzLnpvb21Nb2RlID0gem9vbU1vZGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoJ21hZ25pZmljYXRpb24nKVxuICAgIHB1YmxpYyBzZXQgc2V0TWFnbmlmaWNhdGlvbihtYWduaWZpY2F0aW9uOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5tYWduaWZpY2F0aW9uID0gTnVtYmVyKG1hZ25pZmljYXRpb24pIHx8IHRoaXMubWFnbmlmaWNhdGlvbjtcbiAgICAgICAgdGhpcy56b29tU2Nyb2xsLmVtaXQodGhpcy5tYWduaWZpY2F0aW9uKTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ21pblpvb21SYXRpbycpXG4gICAgcHVibGljIHNldCBzZXRNaW5ab29tUmF0aW8obWluWm9vbVJhdGlvOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgcmF0aW8gPSBOdW1iZXIobWluWm9vbVJhdGlvKSB8fCB0aGlzLm1pblpvb21SYXRpbyB8fCB0aGlzLmJhc2VSYXRpbyB8fCAwO1xuICAgICAgICB0aGlzLm1pblpvb21SYXRpbyA9IE1hdGgubWF4KHJhdGlvLCB0aGlzLmJhc2VSYXRpbyB8fCAwKTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ21heFpvb21SYXRpbycpXG4gICAgcHVibGljIHNldCBzZXRNYXhab29tUmF0aW8obWF4Wm9vbVJhdGlvOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5tYXhab29tUmF0aW8gPSBOdW1iZXIobWF4Wm9vbVJhdGlvKSB8fCB0aGlzLm1heFpvb21SYXRpbztcbiAgICB9XG5cbiAgICBASW5wdXQoJ3Njcm9sbFN0ZXBTaXplJylcbiAgICBwdWJsaWMgc2V0IHNldFNjcm9sbFN0ZXBTaXplKHN0ZXBTaXplOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxTdGVwU2l6ZSA9IE51bWJlcihzdGVwU2l6ZSkgfHwgdGhpcy5zY3JvbGxTdGVwU2l6ZTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ2VuYWJsZUxlbnMnKVxuICAgIHB1YmxpYyBzZXQgc2V0RW5hYmxlTGVucyhlbmFibGU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5lbmFibGVMZW5zID0gQm9vbGVhbihlbmFibGUpO1xuICAgIH1cblxuICAgIEBJbnB1dCgnbGVuc1dpZHRoJylcbiAgICBwdWJsaWMgc2V0IHNldExlbnNXaWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubGVuc1dpZHRoID0gTnVtYmVyKHdpZHRoKSB8fCB0aGlzLmxlbnNXaWR0aDtcbiAgICB9XG5cbiAgICBASW5wdXQoJ2xlbnNIZWlnaHQnKVxuICAgIHB1YmxpYyBzZXQgc2V0TGVuc0hlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmxlbnNIZWlnaHQgPSBOdW1iZXIoaGVpZ2h0KSB8fCB0aGlzLmxlbnNIZWlnaHQ7XG4gICAgfVxuXG4gICAgQElucHV0KCdjaXJjdWxhckxlbnMnKVxuICAgIHB1YmxpYyBzZXQgc2V0Q2lyY3VsYXJMZW5zKGVuYWJsZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLmNpcmN1bGFyTGVucyA9IEJvb2xlYW4oZW5hYmxlKTtcbiAgICB9XG5cbiAgICBASW5wdXQoJ2VuYWJsZVNjcm9sbFpvb20nKVxuICAgIHB1YmxpYyBzZXQgc2V0RW5hYmxlU2Nyb2xsWm9vbShlbmFibGU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5lbmFibGVTY3JvbGxab29tID0gQm9vbGVhbihlbmFibGUpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFVwRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlTGVucykge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2lyY3VsYXJMZW5zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sZW5zQm9yZGVyUmFkaXVzID0gdGhpcy5sZW5zV2lkdGggLyAyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxlbnNCb3JkZXJSYWRpdXMgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlUmF0aW9BbmRPZmZzZXQoKTtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVJbWFnZUFuZExlbnNQb3NpdGlvbigpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLmZvckVhY2goKGRlc3Ryb3lGbikgPT4gZGVzdHJveUZuKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlbXBsYXRlIGhlbHBlciBtZXRob2RzXG4gICAgICovXG4gICAgb25UaHVtYkltYWdlTG9hZGVkKCkge1xuICAgICAgICB0aGlzLnRodW1iSW1hZ2VMb2FkZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmNoZWNrSW1hZ2VzTG9hZGVkKCk7XG4gICAgfVxuXG4gICAgb25GdWxsSW1hZ2VMb2FkZWQoKSB7XG4gICAgICAgIHRoaXMuZnVsbEltYWdlTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jaGVja0ltYWdlc0xvYWRlZCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0VXBFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgaWYgKHRoaXMuem9vbU1vZGUgPT09ICdob3ZlcicpIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnpvb21Db250YWluZXIubmF0aXZlRWxlbWVudCwgJ21vdXNlZW50ZXInLCAoZXZlbnQpID0+IHRoaXMuaG92ZXJNb3VzZUVudGVyKGV2ZW50KSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy56b29tQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWxlYXZlJywgKCkgPT4gdGhpcy5ob3Zlck1vdXNlTGVhdmUoKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy56b29tQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdtb3VzZW1vdmUnLCAoZXZlbnQpID0+IHRoaXMuaG92ZXJNb3VzZU1vdmUoZXZlbnQpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnpvb21Nb2RlID09PSAndG9nZ2xlJykge1xuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuem9vbUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnY2xpY2snLCAoZXZlbnQpID0+IHRoaXMudG9nZ2xlQ2xpY2soZXZlbnQpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnpvb21Nb2RlID09PSAnY2xpY2snKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy56b29tQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdjbGljaycsIChldmVudCkgPT4gdGhpcy5jbGlja1N0YXJ0ZXIoZXZlbnQpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnpvb21Db250YWluZXIubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCAoKSA9PiB0aGlzLmNsaWNrTW91c2VMZWF2ZSgpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnpvb21Db250YWluZXIubmF0aXZlRWxlbWVudCwgJ21vdXNlbW92ZScsIChldmVudCkgPT4gdGhpcy5jbGlja01vdXNlTW92ZShldmVudCkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuem9vbU1vZGUgPT09ICdob3Zlci1mcmVlemUnKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy56b29tQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgKGV2ZW50KSA9PiB0aGlzLmhvdmVyRnJlZXplTW91c2VFbnRlcihldmVudCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuem9vbUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnbW91c2VsZWF2ZScsICgpID0+IHRoaXMuaG92ZXJGcmVlemVNb3VzZUxlYXZlKCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuem9vbUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnbW91c2Vtb3ZlJywgKGV2ZW50KSA9PiB0aGlzLmhvdmVyRnJlZXplTW91c2VNb3ZlKGV2ZW50KSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy56b29tQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdjbGljaycsIChldmVudCkgPT4gdGhpcy5ob3ZlckZyZWV6ZUNsaWNrKGV2ZW50KSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlU2Nyb2xsWm9vbSkge1xuICAgICAgICAgICAgLy8gQ2hyb21lOiAnbW91c2V3aGVlbCcsIEZpcmVmb3g6ICdET01Nb3VzZVNjcm9sbCcsIElFOiAnb25tb3VzZXdoZWVsJ1xuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuem9vbUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnbW91c2V3aGVlbCcsIChldmVudCkgPT4gdGhpcy5vbk1vdXNlV2hlZWwoZXZlbnQpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnpvb21Db250YWluZXIubmF0aXZlRWxlbWVudCwgJ0RPTU1vdXNlU2Nyb2xsJywgKGV2ZW50KSA9PiB0aGlzLm9uTW91c2VXaGVlbChldmVudCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuem9vbUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnb25tb3VzZXdoZWVsJywgKGV2ZW50KSA9PiB0aGlzLm9uTW91c2VXaGVlbChldmVudCkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUxlbnMgJiYgdGhpcy5jaXJjdWxhckxlbnMpIHtcbiAgICAgICAgICAgIHRoaXMubGVuc0JvcmRlclJhZGl1cyA9IHRoaXMubGVuc1dpZHRoIC8gMjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJbWFnZXNMb2FkZWQoKSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlUmF0aW9BbmRPZmZzZXQoKTtcbiAgICAgICAgaWYgKHRoaXMudGh1bWJJbWFnZUxvYWRlZCAmJiB0aGlzLmZ1bGxJbWFnZUxvYWRlZCkge1xuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVJbWFnZUFuZExlbnNQb3NpdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5pc1JlYWR5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFpvb20gcG9zaXRpb24gc2V0dGVyc1xuICAgICAqL1xuICAgIHByaXZhdGUgc2V0Wm9vbVBvc2l0aW9uKGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5sYXRlc3RNb3VzZUxlZnQgPSBOdW1iZXIobGVmdCkgfHwgdGhpcy5sYXRlc3RNb3VzZUxlZnQ7XG4gICAgICAgIHRoaXMubGF0ZXN0TW91c2VUb3AgPSBOdW1iZXIodG9wKSB8fCB0aGlzLmxhdGVzdE1vdXNlVG9wO1xuXG4gICAgICAgIGNvbnN0IGM6IENvb3JkID0ge1xuICAgICAgICAgICAgeDogdGhpcy5sYXRlc3RNb3VzZUxlZnQsXG4gICAgICAgICAgICB5OiB0aGlzLmxhdGVzdE1vdXNlVG9wXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuem9vbVBvc2l0aW9uLmVtaXQoYyk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBNb3VzZSB3aGVlbCBldmVudFxuICAgICAqL1xuICAgIHByaXZhdGUgb25Nb3VzZVdoZWVsKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgLy8gRG9uJ3QgZWF0IGV2ZW50cyBpZiB6b29taW5nIGlzbid0IGFjdGl2ZVxuICAgICAgICBpZiAoIXRoaXMuem9vbWluZ0VuYWJsZWQgfHwgdGhpcy56b29tRnJvemVuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBldmVudCA9IHdpbmRvdy5ldmVudCB8fCBldmVudDsgLy8gb2xkIElFXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IE1hdGgubWF4KE1hdGgubWluKChldmVudC53aGVlbERlbHRhIHx8IC1ldmVudC5kZXRhaWwpLCAxKSwgLTEpO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID4gMCkge1xuICAgICAgICAgICAgLy8gdXBcbiAgICAgICAgICAgIHRoaXMuc2V0TWFnbmlmaWNhdGlvbiA9IE1hdGgubWluKHRoaXMubWFnbmlmaWNhdGlvbiArIHRoaXMuc2Nyb2xsU3RlcFNpemUsIHRoaXMubWF4Wm9vbVJhdGlvKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGRvd25cbiAgICAgICAgICAgIHRoaXMuc2V0TWFnbmlmaWNhdGlvbiA9IE1hdGgubWF4KHRoaXMubWFnbmlmaWNhdGlvbiAtIHRoaXMuc2Nyb2xsU3RlcFNpemUsIHRoaXMubWluWm9vbVJhdGlvKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGN1bGF0ZVJhdGlvKCk7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlWm9vbVBvc2l0aW9uKGV2ZW50KTtcblxuICAgICAgICAvLyBQcmV2ZW50IHNjcm9sbGluZyBvbiBwYWdlLlxuICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlOyAvLyBJRVxuICAgICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIENocm9tZSAmIEZGXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIb3ZlciBtb2RlXG4gICAgICovXG4gICAgcHJpdmF0ZSBob3Zlck1vdXNlRW50ZXIoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgdGhpcy56b29tT24oZXZlbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaG92ZXJNb3VzZUxlYXZlKCkge1xuICAgICAgICB0aGlzLnpvb21PZmYoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhvdmVyTW91c2VNb3ZlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlWm9vbVBvc2l0aW9uKGV2ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgbW9kZVxuICAgICAqL1xuICAgIHByaXZhdGUgdG9nZ2xlQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuem9vbWluZ0VuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuem9vbU9mZigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy56b29tT24oZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgbW9kZVxuICAgICAqL1xuICAgIHByaXZhdGUgY2xpY2tTdGFydGVyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLnpvb21pbmdFbmFibGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy56b29tT24oZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGlja01vdXNlTGVhdmUoKSB7XG4gICAgICAgIHRoaXMuem9vbU9mZigpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xpY2tNb3VzZU1vdmUoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuem9vbWluZ0VuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlWm9vbVBvc2l0aW9uKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhvdmVyIGZyZWV6ZSBtb2RlXG4gICAgICovXG4gICAgcHJpdmF0ZSBob3ZlckZyZWV6ZU1vdXNlRW50ZXIoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuem9vbWluZ0VuYWJsZWQgJiYgIXRoaXMuem9vbUZyb3plbikge1xuICAgICAgICAgICAgdGhpcy56b29tT24oZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBob3ZlckZyZWV6ZU1vdXNlTGVhdmUoKSB7XG4gICAgICAgIGlmICh0aGlzLnpvb21pbmdFbmFibGVkICYmICF0aGlzLnpvb21Gcm96ZW4pIHtcbiAgICAgICAgICAgIHRoaXMuem9vbU9mZigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBob3ZlckZyZWV6ZU1vdXNlTW92ZShldmVudDogTW91c2VFdmVudCkge1xuICAgICAgICBpZiAodGhpcy56b29taW5nRW5hYmxlZCAmJiAhdGhpcy56b29tRnJvemVuKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVpvb21Qb3NpdGlvbihldmVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhvdmVyRnJlZXplQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuem9vbWluZ0VuYWJsZWQgJiYgdGhpcy56b29tRnJvemVuKSB7XG4gICAgICAgICAgICB0aGlzLnpvb21Gcm96ZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuem9vbU9mZigpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuem9vbWluZ0VuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuem9vbUZyb3plbiA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnpvb21PbihldmVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcml2YXRlIGhlbHBlciBtZXRob2RzXG4gICAgICovXG4gICAgcHJpdmF0ZSB6b29tT24oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZWFkeSkge1xuICAgICAgICAgICAgdGhpcy56b29taW5nRW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVJhdGlvQW5kT2Zmc2V0KCk7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVab29tUG9zaXRpb24oZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB6b29tT2ZmKCkge1xuICAgICAgICB0aGlzLnpvb21pbmdFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZVpvb21Qb3NpdGlvbihldmVudDogTW91c2VFdmVudCkge1xuICAgICAgICBjb25zdCBuZXdMZWZ0ID0gTWF0aC5tYXgoTWF0aC5taW4oZXZlbnQub2Zmc2V0WCwgdGhpcy50aHVtYldpZHRoKSwgMCk7XG4gICAgICAgIGNvbnN0IG5ld1RvcCA9IE1hdGgubWF4KE1hdGgubWluKGV2ZW50Lm9mZnNldFksIHRoaXMudGh1bWJIZWlnaHQpLCAwKTtcblxuICAgICAgICB0aGlzLnNldFpvb21Qb3NpdGlvbihuZXdMZWZ0LCBuZXdUb3ApO1xuXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlSW1hZ2VBbmRMZW5zUG9zaXRpb24oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZUltYWdlQW5kTGVuc1Bvc2l0aW9uKCkge1xuICAgICAgICBsZXQgbGVuc0xlZnRNb2QgPSAwO1xuICAgICAgICBsZXQgbGVuc1RvcE1vZCA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlTGVucykge1xuICAgICAgICAgICAgbGVuc0xlZnRNb2QgPSB0aGlzLmxlbnNMZWZ0ID0gdGhpcy5sYXRlc3RNb3VzZUxlZnQgLSB0aGlzLmxlbnNXaWR0aCAvIDI7XG4gICAgICAgICAgICBsZW5zVG9wTW9kID0gdGhpcy5sZW5zVG9wID0gdGhpcy5sYXRlc3RNb3VzZVRvcCAtIHRoaXMubGVuc0hlaWdodCAvIDI7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZ1bGxJbWFnZUxlZnQgPSAodGhpcy5sYXRlc3RNb3VzZUxlZnQgKiAtdGhpcy54UmF0aW8pIC0gbGVuc0xlZnRNb2Q7XG4gICAgICAgIHRoaXMuZnVsbEltYWdlVG9wID0gKHRoaXMubGF0ZXN0TW91c2VUb3AgKiAtdGhpcy55UmF0aW8pIC0gbGVuc1RvcE1vZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZVJhdGlvQW5kT2Zmc2V0KCkge1xuICAgICAgICB0aGlzLnRodW1iV2lkdGggPSB0aGlzLmltYWdlVGh1bWJuYWlsLm5hdGl2ZUVsZW1lbnQud2lkdGg7XG4gICAgICAgIHRoaXMudGh1bWJIZWlnaHQgPSB0aGlzLmltYWdlVGh1bWJuYWlsLm5hdGl2ZUVsZW1lbnQuaGVpZ2h0O1xuXG4gICAgICAgIC8vIElmIGxlbnMgaXMgZGlzYWJsZWQsIHNldCBsZW5zIHNpemUgdG8gZXF1YWwgdGh1bWIgc2l6ZSBhbmQgcG9zaXRpb24gaXQgb24gdG9wIG9mIHRoZSB0aHVtYlxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlTGVucykge1xuICAgICAgICAgICAgdGhpcy5sZW5zV2lkdGggPSB0aGlzLnRodW1iV2lkdGg7XG4gICAgICAgICAgICB0aGlzLmxlbnNIZWlnaHQgPSB0aGlzLnRodW1iSGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5sZW5zTGVmdCA9IDA7XG4gICAgICAgICAgICB0aGlzLmxlbnNUb3AgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgPyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDQwMDg4NzNcbiAgICAgICAgdGhpcy5vZmZzZXRUb3AgPSB0aGlzLmltYWdlVGh1bWJuYWlsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgICAgICB0aGlzLm9mZnNldExlZnQgPSB0aGlzLmltYWdlVGh1bWJuYWlsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcblxuICAgICAgICBpZiAodGhpcy5mdWxsSW1hZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mdWxsSW1hZ2UgPSB0aGlzLnRodW1iSW1hZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5mdWxsSW1hZ2VMb2FkZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZnVsbFdpZHRoID0gdGhpcy5mdWxsU2l6ZUltYWdlLm5hdGl2ZUVsZW1lbnQubmF0dXJhbFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5mdWxsSGVpZ2h0ID0gdGhpcy5mdWxsU2l6ZUltYWdlLm5hdGl2ZUVsZW1lbnQubmF0dXJhbEhlaWdodDtcblxuICAgICAgICAgICAgdGhpcy5iYXNlUmF0aW8gPSBNYXRoLm1heChcbiAgICAgICAgICAgICAgICAodGhpcy50aHVtYldpZHRoIC8gdGhpcy5mdWxsV2lkdGgpLFxuICAgICAgICAgICAgICAgICh0aGlzLnRodW1iSGVpZ2h0IC8gdGhpcy5mdWxsSGVpZ2h0KSk7XG5cbiAgICAgICAgICAgIC8vIERvbid0IGFsbG93IHpvb21pbmcgdG8gc21hbGxlciB0aGFuIHRodW1ibmFpbCBzaXplXG4gICAgICAgICAgICB0aGlzLm1pblpvb21SYXRpbyA9IE1hdGgubWF4KHRoaXMubWluWm9vbVJhdGlvIHx8IDAsIHRoaXMuYmFzZVJhdGlvIHx8IDApO1xuXG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVJhdGlvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGN1bGF0ZVJhdGlvKCkge1xuICAgICAgICB0aGlzLm1hZ25pZmllZFdpZHRoID0gKHRoaXMuZnVsbFdpZHRoICogdGhpcy5tYWduaWZpY2F0aW9uKTtcbiAgICAgICAgdGhpcy5tYWduaWZpZWRIZWlnaHQgPSAodGhpcy5mdWxsSGVpZ2h0ICogdGhpcy5tYWduaWZpY2F0aW9uKTtcblxuICAgICAgICB0aGlzLnhSYXRpbyA9ICh0aGlzLm1hZ25pZmllZFdpZHRoIC0gdGhpcy50aHVtYldpZHRoKSAvIHRoaXMudGh1bWJXaWR0aDtcbiAgICAgICAgdGhpcy55UmF0aW8gPSAodGhpcy5tYWduaWZpZWRIZWlnaHQgLSB0aGlzLnRodW1iSGVpZ2h0KSAvIHRoaXMudGh1bWJIZWlnaHQ7XG4gICAgfVxufVxuIl19