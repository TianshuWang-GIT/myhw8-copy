import { __decorate, __metadata } from "tslib";
import { Injectable, NgZone } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import * as i0 from "@angular/core";
export function win() {
    return window;
}
export function YouTubeRef() {
    return win()['YT'];
}
export function YouTubePlayerRef() {
    return YouTubeRef().Player;
}
export const defaultSizes = {
    height: 270,
    width: 367
};
let YoutubePlayerService = class YoutubePlayerService {
    constructor(zone) {
        this.zone = zone;
        this.ytApiLoaded = false;
        this.api = new ReplaySubject(1);
        this.createApi();
    }
    loadPlayerApi(options) {
        const doc = win().document;
        if (!this.ytApiLoaded) {
            this.ytApiLoaded = true;
            const playerApiScript = doc.createElement('script');
            playerApiScript.type = 'text/javascript';
            playerApiScript.src = `${options.protocol}://www.youtube.com/iframe_api`;
            doc.body.appendChild(playerApiScript);
        }
    }
    setupPlayer(elementId, outputs, sizes, videoId = '', playerVars) {
        const createPlayer = () => {
            if (YouTubePlayerRef) {
                this.createPlayer(elementId, outputs, sizes, videoId, playerVars);
            }
        };
        this.api.subscribe(createPlayer);
    }
    play(player) {
        player.playVideo();
    }
    pause(player) {
        player.pauseVideo();
    }
    playVideo(media, player) {
        const id = media.id.videoId ? media.id.videoId : media.id;
        player.loadVideoById(id);
        this.play(player);
    }
    isPlaying(player) {
        // because YT is not loaded yet 1 is used - YT.PlayerState.PLAYING
        const isPlayerReady = player && player.getPlayerState;
        const playerState = isPlayerReady ? player.getPlayerState() : {};
        const isPlayerPlaying = isPlayerReady
            ? playerState !== YouTubeRef().PlayerState.ENDED &&
                playerState !== YouTubeRef().PlayerState.PAUSED
            : false;
        return isPlayerPlaying;
    }
    createPlayer(elementId, outputs, sizes, videoId = '', playerVars = {}) {
        const playerSize = {
            height: sizes.height || defaultSizes.height,
            width: sizes.width || defaultSizes.width
        };
        const ytPlayer = YouTubePlayerRef();
        return new ytPlayer(elementId, Object.assign(Object.assign({}, playerSize), { events: {
                onReady: (ev) => {
                    this.zone.run(() => outputs.ready && outputs.ready.next(ev.target));
                },
                onStateChange: (ev) => {
                    this.zone.run(() => outputs.change && outputs.change.next(ev));
                }
            }, playerVars,
            videoId }));
    }
    toggleFullScreen(player, isFullScreen) {
        let { height, width } = defaultSizes;
        if (!isFullScreen) {
            height = window.innerHeight;
            width = window.innerWidth;
        }
        player.setSize(width, height);
    }
    // adpoted from uid
    generateUniqueId() {
        const len = 7;
        return Math.random()
            .toString(35)
            .substr(2, len);
    }
    createApi() {
        const onYouTubeIframeAPIReady = () => {
            if (win()) {
                this.api.next(YouTubeRef());
            }
        };
        win()['onYouTubeIframeAPIReady'] = onYouTubeIframeAPIReady;
    }
};
YoutubePlayerService.ɵprov = i0.ɵɵdefineInjectable({ factory: function YoutubePlayerService_Factory() { return new YoutubePlayerService(i0.ɵɵinject(i0.NgZone)); }, token: YoutubePlayerService, providedIn: "root" });
YoutubePlayerService = __decorate([
    Injectable({
        providedIn: 'root'
    }),
    __metadata("design:paramtypes", [NgZone])
], YoutubePlayerService);
export { YoutubePlayerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gteW91dHViZS1wbGF5ZXIvc3JjL2xpYi9uZ3gteW91dHViZS1wbGF5ZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7QUFHckMsTUFBTSxVQUFVLEdBQUc7SUFDakIsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVO0lBQ3hCLE9BQU8sR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDckIsQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0I7SUFDOUIsT0FBTyxVQUFVLEVBQUUsQ0FBQyxNQUFNLENBQUM7QUFDN0IsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRztJQUMxQixNQUFNLEVBQUUsR0FBRztJQUNYLEtBQUssRUFBRSxHQUFHO0NBQ1gsQ0FBQztBQUtGLElBQWEsb0JBQW9CLEdBQWpDLE1BQWEsb0JBQW9CO0lBTS9CLFlBQW9CLElBQVk7UUFBWixTQUFJLEdBQUosSUFBSSxDQUFRO1FBRnhCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBRzFCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxhQUFhLENBQUMsT0FBZ0M7UUFDNUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDO1FBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLE1B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cnQgeyBJbmplY3RhYmxlLCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElQbGF5ZXJBcGlTY3JpcHRPcHRpb25zLCBJUGxheWVyT3V0cHV0cywgSVBsYXllclNpemUgfSBmcm9tICcuL21vZGVscyc7XG5cbmV4cG9ydCBmdW5jdGlvbiB3aW4oKSB7XG4gIHJldHVybiB3aW5kb3c7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBZb3VUdWJlUmVmKCkge1xuICByZXR1cm4gd2luKClbJ1lUJ107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBZb3VUdWJlUGxheWVyUmVmKCkge1xuICByZXR1cm4gWW91VHViZVJlZigpLlBsYXllcjtcbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRTaXplcyA9IHtcbiAgaGVpZ2h0OiAyNzAsXG4gIHdpZHRoOiAzNjdcbn07XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFlvdXR1YmVQbGF5ZXJTZXJ2aWNlIHtcbiAgLy8gYXBpOiBSZXBsYXlTdWJqZWN0PFlULlBsYXllcj47XG4gIGFwaTogUmVwbGF5U3ViamVjdDxhbnk+O1xuXG4gIHByaXZhdGUgeXRBcGlMb2FkZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xuICAgIHRoaXMuYXBpID0gbmV3IFJlcGxheVN1YmplY3QoMSk7XG4gICAgdGhpcy5jcmVhdGVBcGkoKTtcbiAgfVxuXG4gIGxvYWRQbGF5ZXJBcGkob3B0aW9uczogSVBsYXllckFwaVNjcmlwdE9wdGlvbnMpIHtcbiAgICBjb25zdCBkb2MgPSB3aW4oKS5kb2N1bWVudDtcbiAgICBpZiAoIXRoaXMueXRBcGlMb2FkZWQpIHtcbiAgICAgIHRoaXMueXRBcGlMb2FkZWQgPSB0cnVlO1xuICAgICAgY29uc3QgcGxheWVyQXBpU2NyaXB0ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgcGxheWVyQXBpU2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcbiAgICAgIHBsYXllckFwaVNjcmlwdC5zcmMgPSBgJHtvcHRpb25zLnByb3RvY29sfTovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpYDtcbiAgICAgIGRvYy5ib2R5LmFwcGVuZENoaWxkKHBsYXllckFwaVNjcmlwdCk7XG4gICAgfVxuICB9XG5cbiAgc2V0dXBQbGF5ZXIoXG4gICAgZWxlbWVudElkOiBzdHJpbmcsXG4gICAgb3V0cHV0czogSVBsYXllck91dHB1dHMsXG4gICAgc2l6ZXM6IElQbGF5ZXJTaXplLFxuICAgIHZpZGVvSWQgPSAnJyxcbiAgICBwbGF5ZXJWYXJzOiBZVC5QbGF5ZXJWYXJzXG4gICkge1xuICAgIGNvbnN0IGNyZWF0ZVBsYXllciA9ICgpID0+IHtcbiAgICAgIGlmIChZb3VUdWJlUGxheWVyUmVmKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlUGxheWVyKGVsZW1lbnRJZCwgb3V0cHV0cywgc2l6ZXMsIHZpZGVvSWQsIHBsYXllclZhcnMpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5hcGkuc3Vic2NyaWJlKGNyZWF0ZVBsYXllcik7XG4gIH1cblxuICBwbGF5KHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgcGxheWVyLnBsYXlWaWRlbygpO1xuICB9XG5cbiAgcGF1c2UocGxheWVyOiBZVC5QbGF5ZXIpIHtcbiAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xuICB9XG5cbiAgcGxheVZpZGVvKG1lZGlhOiBhbnksIHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgY29uc3QgaWQgPSBtZWRpYS5pZC52aWRlb0lkID8gbWVkaWEuaWQudmlkZW9JZCA6IG1lZGlhLmlkO1xuICAgIHBsYXllci5sb2FkVmlkZW9CeUlkKGlkKTtcbiAgICB0aGlzLnBsYXkocGxheWVyKTtcbiAgfVxuXG4gIGlzUGxheWluZyhwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIC8vIGJlY2F1c2UgWVQgaXMgbm90IGxvYWRlZCB5ZXQgMSBpcyB1c2VkIC0gWVQuUGxheWVyU3RhdGUuUExBWUlOR1xuICAgIGNvbnN0IGlzUGxheWVyUmVhZHk6IGFueSA9IHBsYXllciAmJiBwbGF5ZXIuZ2V0UGxheWVyU3RhdGU7XG4gICAgY29uc3QgcGxheWVyU3RhdGUgPSBpc1BsYXllclJlYWR5ID8gcGxheWVyLmdldFBsYXllclN0YXRlKCkgOiB7fTtcbiAgICBjb25zdCBpc1BsYXllclBsYXlpbmcgPSBpc1BsYXllclJlYWR5XG4gICAgICA/IHBsYXllclN0YXRlICE9PSBZb3VUdWJlUmVmKCkuUGxheWVyU3RhdGUuRU5ERUQgJiZcbiAgICAgICAgcGxheWVyU3RhdGUgIT09IFlvdVR1YmVSZWYoKS5QbGF5ZXJTdGF0ZS5QQVVTRURcbiAgICAgIDogZmFsc2U7XG4gICAgcmV0dXJuIGlzUGxheWVyUGxheWluZztcbiAgfVxuXG4gIGNyZWF0ZVBsYXllcihcbiAgICBlbGVtZW50SWQ6IHN0cmluZyxcbiAgICBvdXRwdXRzOiBJUGxheWVyT3V0cHV0cyxcbiAgICBzaXplczogSVBsYXllclNpemUsXG4gICAgdmlkZW9JZCA9ICcnLFxuICAgIHBsYXllclZhcnM6IFlULlBsYXllclZhcnMgPSB7fVxuICApIHtcbiAgICBjb25zdCBwbGF5ZXJTaXplID0ge1xuICAgICAgaGVpZ2h0OiBzaXplcy5oZWlnaHQgfHwgZGVmYXVsdFNpemVzLmhlaWdodCxcbiAgICAgIHdpZHRoOiBzaXplcy53aWR0aCB8fCBkZWZhdWx0U2l6ZXMud2lkdGhcbiAgICB9O1xuICAgIGNvbnN0IHl0UGxheWVyID0gWW91VHViZVBsYXllclJlZigpO1xuICAgIHJldHVybiBuZXcgeXRQbGF5ZXIoZWxlbWVudElkLCB7XG4gICAgICAuLi5wbGF5ZXJTaXplLFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgIG9uUmVhZHk6IChldjogWVQuUGxheWVyRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuKCgpID0+IG91dHB1dHMucmVhZHkgJiYgb3V0cHV0cy5yZWFkeS5uZXh0KGV2LnRhcmdldCkpO1xuICAgICAgICB9LFxuICAgICAgICBvblN0YXRlQ2hhbmdlOiAoZXY6IFlULlBsYXllckV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBvdXRwdXRzLmNoYW5nZSAmJiBvdXRwdXRzLmNoYW5nZS5uZXh0KGV2KSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwbGF5ZXJWYXJzLFxuICAgICAgdmlkZW9JZFxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlRnVsbFNjcmVlbihcbiAgICBwbGF5ZXI6IFlULlBsYXllcixcbiAgICBpc0Z1bGxTY3JlZW46IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkXG4gICkge1xuICAgIGxldCB7IGhlaWdodCwgd2lkdGggfSA9IGRlZmF1bHRTaXplcztcblxuICAgIGlmICghaXNGdWxsU2NyZWVuKSB7XG4gICAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIH1cbiAgICBwbGF5ZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIC8vIGFkcG90ZWQgZnJvbSB1aWRcbiAgZ2VuZXJhdGVVbmlxdWVJZCgpIHtcbiAgICBjb25zdCBsZW4gPSA3O1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpXG4gICAgICAudG9TdHJpbmcoMzUpXG4gICAgICAuc3Vic3RyKDIsIGxlbik7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUFwaSgpIHtcbiAgICBjb25zdCBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSA9ICgpID0+IHtcbiAgICAgIGlmICh3aW4oKSkge1xuICAgICAgICB0aGlzLmFwaS5uZXh0KFlvdVR1YmVSZWYoKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB3aW4oKVsnb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHknXSA9IG9uWW91VHViZUlmcmFtZUFQSVJlYWR5O1xuICB9XG59XG4iXX0=